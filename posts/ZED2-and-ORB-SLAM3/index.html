<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/" /><meta property="og:url" content="https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/" /><meta property="og:site_name" content="Life Zero Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-04-14T11:11:14+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-14T17:31:27+07:00","datePublished":"2023-04-14T11:11:14+07:00","description":"Introduction","headline":"ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step","mainEntityOfPage":{"@type":"WebPage","@id":"https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/"},"url":"https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/"}</script><title>ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step | Life Zero Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Life Zero Blog"><meta name="application-name" content="Life Zero Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://live.staticflickr.com/7347/14119381583_6087a61c73_c_d.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Life Zero Blog</a></div><div class="site-subtitle font-italic">Life is hard but it's fair</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/lacie-life" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['00sao00ios00','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Life Zero </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 14, 2023, 11:11 AM +0700" >Apr 14<i class="unloaded">2023-04-14T11:11:14+07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 14, 2023, 5:31 PM +0700" >Apr 14<i class="unloaded">2023-04-14T17:31:27+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2587 words">14 min read</span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><p>It is also a project requirement, and needs to use visual inertial navigation to do some development, so the first step is to do some algorithm testing-simulation and physical testing. After passing the simulation test results, it is finally decided to use ORB-SLAM3 to complete the task.</p><ul><li>System version:<b> Ubuntu 20.04, ROS Noetic </b></ul><h2 id="contents">Contents</h2><ul><li>Introduction<li>Cuda and CuDNN installation<li>ZED SDK installation<li>Binocular camera, IMU calibration and joint calibration<li>Algorithm operation results display<li>Discussion</ul><h2 id="cuda-and-cudnn-installation">Cuda and CuDNN installation</h2><ul><li>CUDA Toolkit Install<li>CuDNN install</ul><h2 id="zed-sdk">ZED SDK</h2><ul><li>ZED SDK<li>ZED Python API<li>ZED ROS Wrapper</ul><h2 id="sensor-calibration">Sensor Calibration</h2><h3 id="install-calibration-tool">Install Calibration tool</h3><ul><li>Install dependencies</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get <span class="nb">install </span>python-setuptools python3-rosinstall ipython3 libeigen3-dev libboost-all-dev doxygen libopencv-dev ros-noetic-vision-opencv ros-noetic-image-transport-plugins ros-noetic-cmake-modules software-properties-common libpoco-dev python3-matplotlib python3-scipy python3-git python3-pip libtbb-dev liblapack-dev python3-catkin-tools libv4l-dev

<span class="nb">sudo </span>add-apt-repository ppa:igraph/ppa
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>python3-igraph

</pre></table></code></div></div><ul><li>Create a new workspace, remember to add the environment variable source ~/kalibr_workspace/devel/setup.bash in bashrc</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> ~/kalibr_ws/src
<span class="nb">cd</span> ~/kalibr_ws
catkin_make
</pre></table></code></div></div><ul><li>Download the source code and compile</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="nb">cd</span> ~/kalibr_ws/src

git clone <span class="nt">-b</span> 20 https://github.com/ethz-asl/kalibr.git

catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release <span class="nt">-j4</span>

</pre></table></code></div></div><ul><li>Download and compile code_utils (here to compile under the workspace created by catkin_make, mine is catkin_ws)</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>
<span class="nb">cd</span> ~/catkin_ws/src

git clone hhttps://github.com/gaowenliang/code_utils.git

<span class="nb">sudo </span>apt-get <span class="nb">install </span>libw-dev

<span class="nb">cd</span> ../

catkin_make

</pre></table></code></div></div><ul><li>Download and compile imu_utils</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>git clone https://github.com/geowenliang/imu_utils
<span class="nb">cd</span> ../
catkin_make
</pre></table></code></div></div><h3 id="download-the-calibration-board-and-yaml-file">Download the calibration board and yaml file</h3><p>Enter GitHub to download relevant parameter files https://github.com/ethz-asl/kalibr/wiki/downloads#calibration-targets Select Aprilgrid 6x6 0.8x0.8 m (A0 page), download its pdf and yaml files</p><p><img data-proofer-ignore data-src="https://github.com/lacie-life/lacie-life.github.io/blob/main/assets/img/post_assest/tag.png?raw=true" alt="Fig.1" /></p><p>The following is the yaml file Contents: Among them The <i> codeOffset </i> parameter is useless and can be deleted, tagSize is the side length of the large black square, tagSpacing is the side length of the small black square/the side length of the large black square.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>terget_type: <span class="s1">'aprilgrid'</span>
tagCols: 6
tagRows: 6
tagSize: 0.088
tagSpacing: 0.3
codeoffset: 0
</pre></table></code></div></div><h3 id="zed-2-recording-bag-ready-for-calibration">ZED 2 recording bag ready for calibration</h3><p>Found under the catkin_ws/src/zed-ros-wrapper/zed_wrapper/params foldercommon.yaml (parameter configuration file), which can configure the camera output resolution, <b> I set the resolution to 2, and the resolution size is 1280 720, but in fact, the image resolution obtained by subscribing to the ros topic during calibration is half of this, that is, 640 360 </b></p><p>Start ZED 2:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roslaunch zed_wrapper zed2.launch
rqt_image_view <span class="c"># for viewing image topic</span>
</pre></table></code></div></div><p>The default camera release frequency is 15Hz, and the IMU release frequency is 200Hz. Next, we will start recording the bag package for calibration.</p><h4 id="note">Note</h4><p>(1) Note that when recording, the full picture of the QR code should be exposed in the field of view of the two cameras of the binocular camera, which can be viewed through rqt_image_view.</p><p>(2) Fully move the QR code to every corner of the camera’s field of view.</p><p>(3) Move three rounds along the three axes of the camera, forward, backward, left, and right, and swing back and forth around the three axes for three rounds.</p><p>The specific operations can be performed first.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rosbag record <span class="nt">-o</span> Kalib_data_HD720.bag /zed2/zed_node/imu/data_raw /zed2/zed_node/left/image_rect_color /zed2/zed_node/right/image_rect_color 
</pre></table></code></div></div><p>A total of three topics are recorded, camera images and IMU’s. There are many people on the Internet who say that the frequency should be lowered, but it is not necessary, just record directly.</p><h3 id="camera-calibration">Camera Calibration</h3><p>Remember Kalib_data_HD720.bag (recorded bag package) and april.yaml (calibration board parameter file)Replace it with the path where your actual location is, It will be marked in a while. Anyway, I did not report an error. If I did report an error, I suggest re-recording. During the calibration process, you can visualize whether the corner detection is good, and find that there are serious errors in corner reprojection; –approx-sync 0.04, where 0.04 can be adjusted to 0.1 according to the situation, and the function is to synchronize the data of each camera.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roscore
rosrun kalibr kalibr_calibrate_cameras <span class="nt">--bag</span> Kalib_data_HD720.bag <span class="nt">--topic</span> /zed2/zed_node/left/image_rect_color /zed2/zed_node/right/image_rect_color <span class="nt">--models</span> pinhole-radtan pinhole-radtan <span class="nt">--target</span> april.yaml
</pre></table></code></div></div><p>After the calibration is completed, the camera’s internal reference and other files will be obtained, among which the yaml file can be used for joint calibration.</p><h3 id="imu-calibration">IMU Calibration</h3><p>(1) Manual Calibration</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rosbag record <span class="nt">-o</span> imu_calibration /zed2/zed_node/imu/data_raw
</pre></table></code></div></div><ul><li>To record for more than two hours, create a launch file named ZED2_calibration.launch</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>&lt;launch&gt;
    &lt;node <span class="nv">pkg</span><span class="o">=</span><span class="s2">"imu_utils"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"imu_an"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"imu_an"</span> <span class="nv">output</span><span class="o">=</span><span class="s2">"screen"</span><span class="o">&gt;</span>
        &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">"imu_topic"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"string"</span> <span class="nv">value</span><span class="o">=</span> <span class="s2">"/zed2/zed_node/imu/data_raw"</span>/&gt;
        &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">"imu_name"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"string"</span> <span class="nv">value</span><span class="o">=</span> <span class="s2">"ZED2"</span>/&gt;
        &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">"data_save_path"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"string"</span> <span class="nv">value</span><span class="o">=</span> <span class="s2">"</span><span class="si">$(</span>find imu_utils<span class="si">)</span><span class="s2">/data/"</span>/&gt;
        &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">"max_time_min"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"int"</span> <span class="nv">value</span><span class="o">=</span> <span class="s2">"120"</span>/&gt;
        &lt;param <span class="nv">name</span><span class="o">=</span><span class="s2">"max_cluster"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"int"</span> <span class="nv">value</span><span class="o">=</span> <span class="s2">"200"</span>/&gt;
    &lt;/node&gt;
&lt;/launch&gt;
</pre></table></code></div></div><ul><li>Start calibration</ul><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roslaunch imu_utils ZED2_calibration.launch
rosbag play <span class="nt">-r</span> 200 imu_calibration.bag  
</pre></table></code></div></div><p>Finally, go to the calibration result file to create the corresponding imu.yaml (take the average value of the calibration results Acc and Gyr and fill in the imu.yaml file)</p><p>(2) directly use the official data to create imu.yaml and fill it in</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">#Accelerometers</span>
accelerometer_noise_density: 1.4e-03   <span class="c">#Noise density (continuous-time)</span>
accelerometer_random_walk:   8.0e-05   <span class="c">#Bias random walk</span>
 
<span class="c">#Gyroscopes</span>
gyroscope_noise_density:     8.6e-05   <span class="c">#Noise density (continuous-time)</span>
gyroscope_random_walk:       2.2e-06   <span class="c">#Bias random walk</span>
 
rostopic:                    /zed2/zed_node/imu/data_raw      <span class="c">#the IMU ROS topic</span>
update_rate:                200.0     <span class="c">#Hz (for discretization of the values above)</span>
</pre></table></code></div></div><h3 id="binocular-cameraimu-joint-calibration">Binocular camera/IMU joint calibration</h3><p>Note that the files Kalib_data_HD720.bag, camchain-Kalib_data_HD720.yaml, imu.yaml, and april.yaml should use absolute paths as much as possible</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roscore
rosrun kalibr kalibr_calibrate_imu_camera <span class="nt">--bag</span> Kalib_data_HD720.bag <span class="nt">--cam</span> camchain-Kalib_data_HD720.yaml <span class="nt">--imu</span> imu.yaml <span class="nt">--target</span> april.yaml
</pre></table></code></div></div><p>Finally, the joint calibration parameters Kalib_data_HD720-imu.yaml can be obtained.</p><h2 id="zed-2-runs-orb-slam3">ZED 2 runs ORB-SLAM3</h2><h3 id="compile-and-install-orb-slam3">Compile and install ORB-SLAM3</h3><p>Let’s directly quote the content of a blogger here. I have configured it on three computer devices. In fact, one of the problems is <b> environment variable </b>, add export ROS_PACKAGE_PATH=${ROS_PACKAGE_PATH}:/home/<user_name>/ORB_SLAM3-master/Examples_old/ROS in bashrc (the path should be replaced by your own), one ismissing dependencies, such as the Sophus library. Others can be installed according to the error information. The official website is very detailed. There is another problem.CmakeList fileWhen compiling, on the one hand, the opencv pointer needs to be changed. In the CmakeList file for compiling ros, the compiling part of the .cc file related to AR is deleted, and there are basically no other problems later.</user_name></p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>git clone https://github.com/UZ-SLAMLab/ORB_SLAM3.git
<span class="nb">cd </span>ORB_SLAM3-master
<span class="nb">chmod</span> +x build.sh
./build.sh

<span class="nb">cd </span>ORB_SLAM3-master/Examples_old/ROS/ORB_SLAM3
<span class="nb">mkdir </span>build
<span class="nb">cd </span>build
cmake ..
make
</pre></table></code></div></div><p>Add the configuration file below</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cd  </span>ORB_SLAM3-master/Examples_old/ROS/ORB_SLAM3/src
<span class="nb">touch </span>zed2_stereo_inertial.cc
<span class="nb">touch </span>zed2_stereo_inertial.yaml
</pre></table></code></div></div><p>Add the following information to the zed2_stereo_inertial.cc file</p><div lang="c++" class="language-c++ highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
</pre><td class="rouge-code"><pre>
<span class="cp">#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;fstream&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;chrono&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;queue&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;thread&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;mutex&gt;</span><span class="cp">
</span>
<span class="cp">#include</span><span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cv_bridge/cv_bridge.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;sensor_msgs/Imu.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span><span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
</span>
<span class="cp">#include</span><span class="cpf">"../../../include/System.h"</span><span class="cp">
#include</span><span class="cpf">"include/ImuTypes.h"</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ImuGrabber</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">ImuGrabber</span><span class="p">(){};</span>
    <span class="kt">void</span> <span class="nf">GrabImu</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImuConstPtr</span> <span class="o">&amp;</span><span class="n">imu_msg</span><span class="p">);</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImuConstPtr</span><span class="o">&gt;</span> <span class="n">imuBuf</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">mBufMutex</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">ImageGrabber</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">ImageGrabber</span><span class="p">(</span><span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">System</span><span class="o">*</span> <span class="n">pSLAM</span><span class="p">,</span> <span class="n">ImuGrabber</span> <span class="o">*</span><span class="n">pImuGb</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">bRect</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">bClahe</span><span class="p">)</span><span class="o">:</span> <span class="n">mpSLAM</span><span class="p">(</span><span class="n">pSLAM</span><span class="p">),</span> <span class="n">mpImuGb</span><span class="p">(</span><span class="n">pImuGb</span><span class="p">),</span> <span class="n">do_rectify</span><span class="p">(</span><span class="n">bRect</span><span class="p">),</span> <span class="n">mbClahe</span><span class="p">(</span><span class="n">bClahe</span><span class="p">){}</span>

    <span class="kt">void</span> <span class="nf">GrabImageLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">GrabImageRight</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="nf">GetImage</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span><span class="n">img_msg</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">SyncWithImu</span><span class="p">();</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span><span class="o">&gt;</span> <span class="n">imgLeftBuf</span><span class="p">,</span> <span class="n">imgRightBuf</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">mBufMutexLeft</span><span class="p">,</span><span class="n">mBufMutexRight</span><span class="p">;</span>
   
    <span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">System</span><span class="o">*</span> <span class="n">mpSLAM</span><span class="p">;</span>
    <span class="n">ImuGrabber</span> <span class="o">*</span><span class="n">mpImuGb</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">do_rectify</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">M1l</span><span class="p">,</span><span class="n">M2l</span><span class="p">,</span><span class="n">M1r</span><span class="p">,</span><span class="n">M2r</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">bool</span> <span class="n">mbClahe</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">CLAHE</span><span class="o">&gt;</span> <span class="n">mClahe</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">createCLAHE</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
<span class="p">};</span>



<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"Stereo_Inertial"</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">n</span><span class="p">(</span><span class="s">"~"</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">set_logger_level</span><span class="p">(</span><span class="n">ROSCONSOLE_DEFAULT_NAME</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">console</span><span class="o">::</span><span class="n">levels</span><span class="o">::</span><span class="n">Info</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">bEqual</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">||</span> <span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">"Usage: rosrun ORB_SLAM3 Stereo_Inertial path_to_vocabulary path_to_settings do_rectify [do_equalize]"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">sbRect</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sbEqual</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sbEqual</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">)</span>
      <span class="n">bEqual</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Create SLAM system. It initializes all system threads and gets ready to process frames.</span>
  <span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">System</span> <span class="nf">SLAM</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">System</span><span class="o">::</span><span class="n">IMU_STEREO</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>

  <span class="n">ImuGrabber</span> <span class="n">imugb</span><span class="p">;</span>
  <span class="n">ImageGrabber</span> <span class="nf">igb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SLAM</span><span class="p">,</span><span class="o">&amp;</span><span class="n">imugb</span><span class="p">,</span><span class="n">sbRect</span> <span class="o">==</span> <span class="s">"true"</span><span class="p">,</span><span class="n">bEqual</span><span class="p">);</span>
  
    <span class="k">if</span><span class="p">(</span><span class="n">igb</span><span class="p">.</span><span class="n">do_rectify</span><span class="p">)</span>
    <span class="p">{</span>      
        <span class="c1">// Load settings related to stereo calibration</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">FileStorage</span> <span class="n">fsSettings</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cv</span><span class="o">::</span><span class="n">FileStorage</span><span class="o">::</span><span class="n">READ</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fsSettings</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"ERROR: Wrong path to settings"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">K_l</span><span class="p">,</span> <span class="n">K_r</span><span class="p">,</span> <span class="n">P_l</span><span class="p">,</span> <span class="n">P_r</span><span class="p">,</span> <span class="n">R_l</span><span class="p">,</span> <span class="n">R_r</span><span class="p">,</span> <span class="n">D_l</span><span class="p">,</span> <span class="n">D_r</span><span class="p">;</span>
        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.K"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">K_l</span><span class="p">;</span>
        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.K"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">K_r</span><span class="p">;</span>

        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.P"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">P_l</span><span class="p">;</span>
        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.P"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">P_r</span><span class="p">;</span>

        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.R"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">R_l</span><span class="p">;</span>
        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.R"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">R_r</span><span class="p">;</span>

        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.D"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">D_l</span><span class="p">;</span>
        <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.D"</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">D_r</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">rows_l</span> <span class="o">=</span> <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.height"</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">cols_l</span> <span class="o">=</span> <span class="n">fsSettings</span><span class="p">[</span><span class="s">"LEFT.width"</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">rows_r</span> <span class="o">=</span> <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.height"</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">cols_r</span> <span class="o">=</span> <span class="n">fsSettings</span><span class="p">[</span><span class="s">"RIGHT.width"</span><span class="p">];</span>

        <span class="k">if</span><span class="p">(</span><span class="n">K_l</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">K_r</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">P_l</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">P_r</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">R_l</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">R_r</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">D_l</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span> <span class="n">D_r</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">||</span>
                <span class="n">rows_l</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="n">rows_r</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="n">cols_l</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="n">cols_r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"ERROR: Calibration parameters to rectify stereo are missing!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span><span class="n">K_l</span><span class="p">,</span><span class="n">D_l</span><span class="p">,</span><span class="n">R_l</span><span class="p">,</span><span class="n">P_l</span><span class="p">.</span><span class="n">rowRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">).</span><span class="n">colRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="n">cols_l</span><span class="p">,</span><span class="n">rows_l</span><span class="p">),</span><span class="n">CV_32F</span><span class="p">,</span><span class="n">igb</span><span class="p">.</span><span class="n">M1l</span><span class="p">,</span><span class="n">igb</span><span class="p">.</span><span class="n">M2l</span><span class="p">);</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span><span class="n">K_r</span><span class="p">,</span><span class="n">D_r</span><span class="p">,</span><span class="n">R_r</span><span class="p">,</span><span class="n">P_r</span><span class="p">.</span><span class="n">rowRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">).</span><span class="n">colRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="n">cols_r</span><span class="p">,</span><span class="n">rows_r</span><span class="p">),</span><span class="n">CV_32F</span><span class="p">,</span><span class="n">igb</span><span class="p">.</span><span class="n">M1r</span><span class="p">,</span><span class="n">igb</span><span class="p">.</span><span class="n">M2r</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="c1">// Maximum delay, 5 seconds</span>
  <span class="c1">//ros::Subscriber sub_imu = n.subscribe("/imu", 1000, &amp;ImuGrabber::GrabImu, &amp;imugb);</span>
  <span class="c1">//ros::Subscriber sub_img_left = n.subscribe("/camera/left/image_raw", 100, &amp;ImageGrabber::GrabImageLeft,&amp;igb);</span>
  <span class="c1">//ros::Subscriber sub_img_right = n.subscribe("/camera/right/image_raw", 100, &amp;ImageGrabber::GrabImageRight,&amp;igb);</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">sub_imu</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"/zed2/zed_node/imu/data_raw"</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ImuGrabber</span><span class="o">::</span><span class="n">GrabImu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">imugb</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">sub_img_left</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"/zed2/zed_node/left/image_rect_color"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ImageGrabber</span><span class="o">::</span><span class="n">GrabImageLeft</span><span class="p">,</span><span class="o">&amp;</span><span class="n">igb</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span> <span class="n">sub_img_right</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"/zed2/zed_node/right/image_rect_color"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ImageGrabber</span><span class="o">::</span><span class="n">GrabImageRight</span><span class="p">,</span><span class="o">&amp;</span><span class="n">igb</span><span class="p">);</span>



  <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="nf">sync_thread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ImageGrabber</span><span class="o">::</span><span class="n">SyncWithImu</span><span class="p">,</span><span class="o">&amp;</span><span class="n">igb</span><span class="p">);</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">spin</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">ImageGrabber</span><span class="o">::</span><span class="n">GrabImageLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span><span class="n">img_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
  <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">img_msg</span><span class="p">);</span>
  <span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImageGrabber</span><span class="o">::</span><span class="n">GrabImageRight</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span><span class="n">img_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imgRightBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
  <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">img_msg</span><span class="p">);</span>
  <span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">ImageGrabber</span><span class="o">::</span><span class="n">GetImage</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImageConstPtr</span> <span class="o">&amp;</span><span class="n">img_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Copy the ros image message to cv::Mat.</span>
  <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImageConstPtr</span> <span class="n">cv_ptr</span><span class="p">;</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="n">cv_ptr</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvShare</span><span class="p">(</span><span class="n">img_msg</span><span class="p">,</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">image_encodings</span><span class="o">::</span><span class="n">MONO8</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">cv_bridge</span><span class="o">::</span><span class="n">Exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">"cv_bridge exception: %s"</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
  <span class="p">}</span>
  
  <span class="k">if</span><span class="p">(</span><span class="n">cv_ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">cv_ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Error type"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cv_ptr</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImageGrabber</span><span class="o">::</span><span class="n">SyncWithImu</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">maxTimeDiff</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">imLeft</span><span class="p">,</span> <span class="n">imRight</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">tImLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tImRight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="o">&amp;&amp;!</span><span class="n">imgRightBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="o">&amp;&amp;!</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">tImLeft</span> <span class="o">=</span> <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span>
      <span class="n">tImRight</span> <span class="o">=</span> <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span>

      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
      <span class="k">while</span><span class="p">((</span><span class="n">tImLeft</span><span class="o">-</span><span class="n">tImRight</span><span class="p">)</span><span class="o">&gt;</span><span class="n">maxTimeDiff</span> <span class="o">&amp;&amp;</span> <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">tImRight</span> <span class="o">=</span> <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>

      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
      <span class="k">while</span><span class="p">((</span><span class="n">tImRight</span><span class="o">-</span><span class="n">tImLeft</span><span class="p">)</span><span class="o">&gt;</span><span class="n">maxTimeDiff</span> <span class="o">&amp;&amp;</span> <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">tImLeft</span> <span class="o">=</span> <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>

      <span class="k">if</span><span class="p">((</span><span class="n">tImLeft</span><span class="o">-</span><span class="n">tImRight</span><span class="p">)</span><span class="o">&gt;</span><span class="n">maxTimeDiff</span> <span class="o">||</span> <span class="p">(</span><span class="n">tImRight</span><span class="o">-</span><span class="n">tImLeft</span><span class="p">)</span><span class="o">&gt;</span><span class="n">maxTimeDiff</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="c1">// std::cout &lt;&lt; "big time difference" &lt;&lt; std::endl;</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">tImLeft</span><span class="o">&gt;</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">())</span>
          <span class="k">continue</span><span class="p">;</span>

      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
      <span class="n">imLeft</span> <span class="o">=</span> <span class="n">GetImage</span><span class="p">(</span><span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
      <span class="n">imgLeftBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexLeft</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>

      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
      <span class="n">imRight</span> <span class="o">=</span> <span class="n">GetImage</span><span class="p">(</span><span class="n">imgRightBuf</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
      <span class="n">imgRightBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">mBufMutexRight</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>

      <span class="n">vector</span><span class="o">&lt;</span><span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">IMU</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">vImuMeas</span><span class="p">;</span>
      <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">mBufMutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
      <span class="p">{</span>
        <span class="c1">// Load imu measurements from buffer</span>
        <span class="n">vImuMeas</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">()</span><span class="o">&lt;=</span><span class="n">tImLeft</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span><span class="p">.</span><span class="n">toSec</span><span class="p">();</span>
          <span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span> <span class="n">acc</span><span class="p">(</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">linear_acceleration</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
          <span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span> <span class="n">gyr</span><span class="p">(</span><span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">front</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">angular_velocity</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
          <span class="n">vImuMeas</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ORB_SLAM3</span><span class="o">::</span><span class="n">IMU</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="n">gyr</span><span class="p">,</span><span class="n">t</span><span class="p">));</span>
          <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">imuBuf</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">mpImuGb</span><span class="o">-&gt;</span><span class="n">mBufMutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="n">mbClahe</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">mClahe</span><span class="o">-&gt;</span><span class="n">apply</span><span class="p">(</span><span class="n">imLeft</span><span class="p">,</span><span class="n">imLeft</span><span class="p">);</span>
        <span class="n">mClahe</span><span class="o">-&gt;</span><span class="n">apply</span><span class="p">(</span><span class="n">imRight</span><span class="p">,</span><span class="n">imRight</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">do_rectify</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">remap</span><span class="p">(</span><span class="n">imLeft</span><span class="p">,</span><span class="n">imLeft</span><span class="p">,</span><span class="n">M1l</span><span class="p">,</span><span class="n">M2l</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">INTER_LINEAR</span><span class="p">);</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">remap</span><span class="p">(</span><span class="n">imRight</span><span class="p">,</span><span class="n">imRight</span><span class="p">,</span><span class="n">M1r</span><span class="p">,</span><span class="n">M2r</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">INTER_LINEAR</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="n">mpSLAM</span><span class="o">-&gt;</span><span class="n">TrackStereo</span><span class="p">(</span><span class="n">imLeft</span><span class="p">,</span><span class="n">imRight</span><span class="p">,</span><span class="n">tImLeft</span><span class="p">,</span><span class="n">vImuMeas</span><span class="p">);</span>

      <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span> <span class="nf">tSleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">tSleep</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ImuGrabber</span><span class="o">::</span><span class="n">GrabImu</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">ImuConstPtr</span> <span class="o">&amp;</span><span class="n">imu_msg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">mBufMutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="n">imuBuf</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">imu_msg</span><span class="p">);</span>
  <span class="n">mBufMutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Add the following information in zed2_stereo_inertial.yaml (here are my camera parameters, you can modify it according to your own situation)</p><p>I directly use the DKRP data in the camera_info topic of the original image of the ZED left and right eyes, you can find it in the rostopic list , In addition, the zed2 camera baseline length is 120.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre><td class="rouge-code"><pre>
%YAML:1.0

<span class="c">#--------------------------------------------------------------------------------------------</span>
<span class="c"># Camera Parameters. Adjust them!</span>
<span class="c">#--------------------------------------------------------------------------------------------</span>
Camera.type: <span class="s2">"PinHole"</span>

<span class="c"># Camera calibration and distortion parameters (OpenCV) (equal for both cameras after stereo rectification)</span>
Camera.fx: 256.5277384633465
Camera.fy: 258.08249705047217
Camera.cx: 325.50319459226085
Camera.cy: 180.96517806223522


Camera.k1: <span class="nt">-0</span>.020457937535071292
Camera.k2: 0.01104746035697357
Camera.p1: 0.00020521550183980535
Camera.p2: <span class="nt">-0</span>.0015638016748186173

Camera.width: 640
Camera.height: 360

<span class="c"># Camera frames per second</span>
Camera.fps: 15.0

<span class="c"># stereo baseline times fx </span>
Camera.bf: 30.7824

<span class="c"># Color order of the images (0: BGR, 1: RGB. It is ignored if images are grayscale)</span>
Camera.RGB: 1

<span class="c"># Close/Far threshold. Baseline times.</span>
ThDepth: 40.0 <span class="c"># 35</span>

<span class="c"># Transformation from camera 0 to body-frame (imu)</span>

Tbc: <span class="o">!!</span>opencv-matrix
        rows: 4
        cols: 4
        dt: f
        data: <span class="o">[</span> 0.011189492088057723, <span class="nt">-0</span>.005170435177808852, 0.999924028047573, <span class="nt">-0</span>.030171769239718378,
                <span class="nt">-0</span>.9999089154286149, <span class="nt">-0</span>.0076051555206256005, 0.011149998021449559, +0.006834916768468505,
                0.007546927400109649, <span class="nt">-0</span>.9999577132107034, <span class="nt">-0</span>.0052550620584632945, <span class="nt">-0</span>.018995636408175094,
                0.0, 0.0, 0.0, 1.0]

<span class="c"># IMU noise</span>
<span class="c"># get it from Project of **zed-examples/tutorials/tutorial 7 - sensor data/**.</span>
IMU.NoiseGyro: 8.6e-05 <span class="c"># 1.6968e-04</span>
IMU.NoiseAcc:  0.0014 <span class="c"># 2.0000e-3</span>
IMU.GyroWalk:  2.2e-06
IMU.AccWalk:   8.0e-05 <span class="c"># 3.0000e-3</span>
IMU.Frequency: 200

<span class="c">#--------------------------------------------------------------------------------------------</span>
<span class="c"># Stereo Rectification. Only if you need to pre-rectify the images.</span>
<span class="c"># Camera.fx, .fy, etc must be the same as in LEFT.P</span>
<span class="c">#--------------------------------------------------------------------------------------------</span>
LEFT.height: 360
LEFT.width: 640
LEFT.D: <span class="o">!!</span>opencv-matrix
        rows: 1
        cols: 5
        dt: d
        data: <span class="o">[</span><span class="nt">-0</span>.040750399231910706, 0.009019049815833569, <span class="nt">-0</span>.004655580036342144, <span class="nt">-0</span>.0006361529813148081, 0.0003129479882773012]
LEFT.K: <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 3
        dt: d
        data: <span class="o">[</span>264.1424865722656, 0.0, 328.0299987792969, 0.0, 263.9525146484375, 180.45175170898438, 0.0, 0.0, 1.0]
LEFT.R:  <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 3
        dt: d
        data: <span class="o">[</span>1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]
LEFT.Rf:  <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 3
        dt: f
        data: <span class="o">[</span>1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]
LEFT.P:  <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 4
        dt: d
        data: <span class="o">[</span>264.1424865722656, 0.0, 328.0299987792969, 0.0, 0.0, 263.9525146484375, 180.45175170898438, 0.0, 0.0, 0.0, 1.0, 0.0]

RIGHT.height: 360
RIGHT.width: 640
RIGHT.D: <span class="o">!!</span>opencv-matrix
        rows: 1
        cols: 5
        dt: d
        data: <span class="o">[</span><span class="nt">-0</span>.03843430057168007, 0.005912320222705603, <span class="nt">-0</span>.0034095800947397947, 6.041819870006293e-05, <span class="nt">-0</span>.00011238799925195053]
RIGHT.K: <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 3
        dt: d
        data: <span class="o">[</span>263.0425109863281, 0.0, 326.2799987792969, 0.0, 262.93499755859375, 180.3209991455078, 0.0, 0.0, 1.0]
RIGHT.R:  <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 3
        dt: d
        data: <span class="o">[</span>1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]
RIGHT.P:  <span class="o">!!</span>opencv-matrix
        rows: 3
        cols: 4
        dt: d
        data: <span class="o">[</span>263.0425109863281, 0.0, 326.2799987792969, <span class="nt">-31</span>.668317794799805, 0.0, 262.93499755859375, 180.3209991455078, 0.0, 0.0, 0.0, 1.0, 0.0]

<span class="c">#--------------------------------------------------------------------------------------------</span>
<span class="c"># ORB Parameters</span>
<span class="c">#--------------------------------------------------------------------------------------------</span>

<span class="c"># ORB Extractor: Number of features per image</span>
ORBextractor.nFeatures: 2200

<span class="c"># ORB Extractor: Scale factor between levels in the scale pyramid</span>
ORBextractor.scaleFactor: 1.2

<span class="c"># ORB Extractor: Number of levels in the scale pyramid</span>
ORBextractor.nLevels: 8

<span class="c"># ORB Extractor: Fast threshold</span>
<span class="c"># Image is divided in a grid. At each cell FAST are extracted imposing a minimum response.</span>
<span class="c"># Firstly we impose iniThFAST. If no corners are detected we impose a lower value minThFAST</span>
<span class="c"># You can lower these values if your images have low contrast</span>
ORBextractor.iniThFAST: 20
ORBextractor.minThFAST: 7

<span class="c">#--------------------------------------------------------------------------------------------</span>
<span class="c"># Viewer Parameters</span>
<span class="c">#--------------------------------------------------------------------------------------------</span>
Viewer.KeyFrameSize: 0.05
Viewer.KeyFrameLineWidth: 1
Viewer.GraphLineWidth: 0.9
Viewer.PointSize:2
Viewer.CameraSize: 0.08
Viewer.CameraLineWidth: 3
Viewer.ViewpointX: 0
Viewer.ViewpointY: <span class="nt">-0</span>.7
Viewer.ViewpointZ: <span class="nt">-1</span>.8
Viewer.ViewpointF: 500
</pre></table></code></div></div><p>Edit the CMakeLists.txt file</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd </span>ORB_SLAM3-master/Examples_old/ROS/ORB_SLAM3
gedit CMakeLists.txt
</pre></table></code></div></div><p>Add at the bottom</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>rosbuild_add_executable<span class="o">(</span>zed2_stereo_inertial
    src/zed2_stereo_inertial.cc
<span class="o">)</span>

target_link_libraries<span class="o">(</span>zed2_stereo_inertial
    <span class="k">${</span><span class="nv">LIBS</span><span class="k">}</span>
<span class="o">)</span>
</pre></table></code></div></div><p>Just recompile, if the executable file cannot be found, run</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>rospack profile

</pre></table></code></div></div><h2 id="algorithm-operation-results-display">Algorithm operation results display</h2><h2 id="discussion">Discussion</h2></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/computer-vision/'>Computer Vision</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >Tutorial</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step - Life Zero Blog&url=https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step - Life Zero Blog&u=https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step - Life Zero Blog&url=https://lacie-life.github.io/posts/ZED2-and-ORB-SLAM3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ZED2-and-ORB-SLAM3/">ZED2 with ORB-SLAM3 (Stereo-IMU mode) step-by-step</a><li><a href="/posts/Callback-Function-in-C++/">Designing Callbacks in C++</a><li><a href="/posts/ML-for-3D-Geometry-4/">ML for 3D Geometry - Part 4</a><li><a href="/posts/ML-for-3D-Geometry-5/">ML for 3D Geometry - Part 5</a><li><a href="/posts/ML-for-3D-Geometry-10/">ML for 3D Geometry - Part 10</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/theory/">Theory</a> <a class="post-tag" href="/tags/writting/">writting</a> <a class="post-tag" href="/tags/project/">Project</a> <a class="post-tag" href="/tags/note/">note</a> <a class="post-tag" href="/tags/collection/">collection</a> <a class="post-tag" href="/tags/cuda/">CUDA</a> <a class="post-tag" href="/tags/opencv/">openCV</a> <a class="post-tag" href="/tags/paper/">paper</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Computer-Vision-Fundamental-1/"><div class="card-body"> <span class="timeago small" >Jun 10, 2022<i class="unloaded">2022-06-10T11:11:11+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Vision Fundamental - [Part 1]</h3><div class="text-muted small"><p> These notes are lecture notes on the Computer Vision II - Multiple View Geometry course held in the summer term 2021 by Prof. Daniel Cremers/Prof. Florian Bernard. Ref Chapter 1 - Mathematical Ba...</p></div></div></a></div><div class="card"> <a href="/posts/Computer-Vision-Fundamental-2/"><div class="card-body"> <span class="timeago small" >Jun 11, 2022<i class="unloaded">2022-06-11T11:11:11+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Vision Fundamental - [Part 2]</h3><div class="text-muted small"><p> Chapter 2 - Representing a Moving Scene Origins of 3D Reconstruction 3D reconstruction is a classical ill-posed problem, as its solutions are not unique (most extreme example: imagine a photograph...</p></div></div></a></div><div class="card"> <a href="/posts/Computer-Vision-Fundamental-3/"><div class="card-body"> <span class="timeago small" >Jun 12, 2022<i class="unloaded">2022-06-12T11:11:11+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Computer Vision Fundamental - [Part 3]</h3><div class="text-muted small"><p> Chapter 3 - Perspective Projection Goal of MVG: invert the image formation process. One part of the formation process is the camera motion (last lecture). The second one is the projection of point...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Callback-Function-in-C++/" class="btn btn-outline-primary" prompt="Older"><p>Designing Callbacks in C++</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">Life Zero</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/machine-learning/">Machine Learning</a> <a class="post-tag" href="/tags/theory/">Theory</a> <a class="post-tag" href="/tags/writting/">writting</a> <a class="post-tag" href="/tags/project/">Project</a> <a class="post-tag" href="/tags/note/">note</a> <a class="post-tag" href="/tags/collection/">collection</a> <a class="post-tag" href="/tags/cuda/">CUDA</a> <a class="post-tag" href="/tags/opencv/">openCV</a> <a class="post-tag" href="/tags/paper/">paper</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://lacie-life.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
